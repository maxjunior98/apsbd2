CREATE TABLE PEDIDOS_AUDITORIA(
	OPERACAO CHAR, DATA_OP TIMESTAMP, USUARIO VARCHAR,
	CODIGOPEDIDO INTEGER, DATAPEDIDO DATE, IDLOJA INTEGER,
	IDCONTA INTEGER, IDPRODUTO INTEGER
)


CREATE OR REPLACE FUNCTION process_ped_audit()
RETURNS TRIGGER AS $pedid_audit$
BEGIN
IF (TG_OP = 'DELETE') THEN
	INSERT INTO PEDIDOS_AUDITORIA SELECT 'D', now(), user, OLD.*;
	RETURN OLD;
ELSEIF (TG_OP = 'UPDATE') THEN
	INSERT INTO PEDIDOS_AUDITORIA SELECT 'U', now(), user, NEW.*;
	RETURN NEW;
ELSEIF (TG_OP = 'INSERT') THEN
	INSERT INTO PEDIDOS_AUDITORIA SELECT  'I', now(), user, NEW.*;
	RETURN NEW;
END IF;
RETURN NULL;
END;
$pedid_audit$ LANGUAGE PLPGSQL;


CREATE TRIGGER pedid_audit 
AFTER INSERT OR UPDATE OR DELETE ON PEDIDOS
FOR EACH ROW EXECUTE PROCEDURE process_ped_audit();